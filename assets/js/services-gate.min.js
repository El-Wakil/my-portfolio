/* services-gate.min.js (client-side gate) NOTE: This is only obfuscation, not real security. */
(()=>{"use strict";const D=window.crypto?.subtle;const d=(s)=>new TextEncoder().encode(s);async function h(t){const b=await D.digest("SHA-256",d(t));return Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,"0")).join("");}
// Hash obfuscated (base64 of hex) -> atob -> compare
const H_hex=(()=>{const a="MjI1NDhkOTkyYWIyYmJiZTdmMDQxNjg1NzJiOWNmODQ5ODcwYjBkMTc2ZjU4MGJiZDBjN2IxODJhZGU1MGI0Yw==";try{return atob(a);}catch(e){return""}})();
const Q=(q)=>document.getElementById(q);
const F=Q("gate-form"),I=Q("gate-pass"),E=Q("gate-error"),C=Q("caps"),TP=Q("togglePass"),EO=Q("eyeOpen"),EC=Q("eyeClosed"),SB=Q("submitBtn"),TT=Q("toggleTheme");
function err(v){if(v){E.style.display="block";F.classList.remove("shake");void F.offsetWidth;F.classList.add("shake");}else E.style.display="none";}
TP&&TP.addEventListener("click",()=>{const sh=I.type==="text";I.type=sh?"password":"text";TP.setAttribute("aria-pressed",(!sh).toString());TP.setAttribute("aria-label",sh?"Show password":"Hide password");EO.style.display=sh?"block":"none";EC.style.display=sh?"none":"block";I.focus({preventScroll:!0});});
I&&I.addEventListener("keydown",e=>{if(e.getModifierState&&e.getModifierState("CapsLock")){C.style.display="inline-block"}else{C.style.display="none"}});
I&&I.addEventListener("blur",()=>{C.style.display="none"});
I&&I.addEventListener("input",()=>{if(E.style.display==="block") err(false)});
F&&F.addEventListener("submit",async e=>{e.preventDefault();const v=I.value.trim();if(!v)return;SB.classList.add("loading");SB.disabled=true;const eh=await h(v);if(eh===H_hex.toLowerCase()){SB.classList.add("success-pulse");setTimeout(()=>{try{sessionStorage.setItem("services_unlocked","1")}catch(_){};window.location.replace("services_private_page_x.html");},500);}else{err(true);I.setAttribute("aria-invalid","true");I.focus();I.select();SB.disabled=false;SB.classList.remove("loading");}});
// Theme Toggle + persistence
(function(){if(!TT)return;try{const s=sessionStorage.getItem("pw_gate_theme");if(s==="dark")document.body.classList.add("dark");else if(s==="light")document.body.classList.remove("dark");else if(window.matchMedia("(prefers-color-scheme: dark)").matches)document.body.classList.add("dark");}catch(_){}TT.setAttribute("aria-checked",document.body.classList.contains("dark")?"true":"false");TT.addEventListener("click",()=>{document.body.classList.toggle("dark");const dk=document.body.classList.contains("dark");TT.setAttribute("aria-checked",dk?"true":"false");try{sessionStorage.setItem("pw_gate_theme",dk?"dark":"light")}catch(_){} });TT.addEventListener("keydown",e=>{if(e.key===" "||e.key==="Enter"){e.preventDefault();TT.click();}})})();})();